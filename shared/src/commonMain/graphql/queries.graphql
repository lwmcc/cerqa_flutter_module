# GraphQL queries for your actual Amplify schema

# Get a specific user by ID
query GetUser($id: ID!) {
  getUser(id: $id) {
    id
    userId
    firstName
    lastName
    name
    phone
    userName
    email
    avatarUri
    createdAt
    updatedAt
  }
}

# Get user by userId (Cognito ID)
# NOTE: Commented out - not available in API wtl5wlqxxvb6lp2nenxcjpvpwq
# Use ListByPhone or GetUser instead
#query GetUserByUserId($userId: String!) {
#  getUserByUserId(userId: $userId) {
#    id
#    userId
#    userName
#    email
#    avatarUri
#    firstName
#    lastName
#    name
#    phone
#  }
#}

# List all users
query ListUsers($filter: ModelUserFilterInput, $limit: Int, $nextToken: String) {
  listUsers(filter: $filter, limit: $limit, nextToken: $nextToken) {
    items {
      id
      userId
      firstName
      lastName
      name
      phone
      userName
      email
      avatarUri
      createdAt
      updatedAt
    }
    nextToken
  }
}

# List UserContacts (the join table connecting users to their contacts)
query ListUserContacts($filter: ModelUserContactFilterInput, $limit: Int, $nextToken: String) {
  listUserContacts(filter: $filter, limit: $limit, nextToken: $nextToken) {
    items {
      id
      userId
      contactId
      user {
        id
        userId
        firstName
        lastName
        name
        phone
        userName
        email
        avatarUri
      }
      contact {
        id
        userId
        firstName
        lastName
        name
        phone
        userName
        email
        avatarUri
      }
      createdAt
      updatedAt
    }
    nextToken
  }
}

# Find user by phone number (uses secondary index)
query ListByPhone($phone: String!, $userName: ModelStringKeyConditionInput, $sortDirection: ModelSortDirection, $filter: ModelUserFilterInput, $limit: Int, $nextToken: String) {
  listByPhone(phone: $phone, userName: $userName, sortDirection: $sortDirection, filter: $filter, limit: $limit, nextToken: $nextToken) {
    items {
      id
      userId
      firstName
      lastName
      name
      phone
      userName
      email
      avatarUri
      createdAt
      updatedAt
    }
    nextToken
  }
}

# Check if user profile is complete (Lambda function: hasUserCreatedProfile)
# NOTE: Commented out - not available in API wtl5wlqxxvb6lp2nenxcjpvpwq
#query HasUserCreatedProfile($userId: String!) {
#  hasUserCreatedProfile(userId: $userId) {
#    isProfileComplete
#    missingFields
#  }
#}

# List Invites (for connection requests)
query ListInvites($filter: ModelInviteFilterInput, $limit: Int, $nextToken: String) {
  listInvites(filter: $filter, limit: $limit, nextToken: $nextToken) {
    items {
      id
      userId
      senderId
      receiverId
      user {
        id
        userId
        firstName
        lastName
        name
        phone
        userName
        email
        avatarUri
      }
      createdAt
      updatedAt
    }
    nextToken
  }
}

# Fetches a JWT for Ably real-time services
query FetchAblyJwt($userId: String!) {
  fetchAblyJwt(userId: $userId) {
    keyName
    clientId
    timestamp
    nonce
    mac
  }
}

# List notifications for a user
# NOTE: Commented out - not available in API wtl5wlqxxvb6lp2nenxcjpvpwq
#query ListNotifications($filter: ModelNotificationFilterInput, $limit: Int, $nextToken: String) {
#  listNotifications(filter: $filter, limit: $limit, nextToken: $nextToken) {
#    items {
#      id
#      userId
#      type
#      title
#      message
#      isRead
#      relatedId
#      senderUserId
#      senderName
#      createdAt
#      updatedAt
#    }
#    nextToken
#  }
#}

# Get unread notification count for a user
# NOTE: Commented out - not available in API wtl5wlqxxvb6lp2nenxcjpvpwq
#query GetUnreadNotificationCount($userId: ID!) {
#  listNotifications(filter: { userId: { eq: $userId }, isRead: { eq: false } }, limit: 1000) {
#    items {
#      id
#    }
#  }
#}

# List channels for the current user (channels where user is creator or receiver)
query ListUserChannels($userId: String!) {
  listChannels(
    filter: {
      or: [
        { creatorId: { eq: $userId } }
        { receiverId: { eq: $userId } }
      ]
    }
    limit: 100
  ) {
    items {
      id
      name
      creatorId
      receiverId
      isGroup
      isPublic
      createdAt
      updatedAt
      creator {
        id
        userId
        userName
        name
        firstName
        lastName
      }
      receiver {
        id
        userId
        userName
        name
        firstName
        lastName
      }
      messages(limit: 1, sortDirection: DESC) {
        items {
          id
          content
          senderId
          createdAt
        }
      }
    }
    nextToken
  }
}

# Get all messages for a specific channel
query ListChannelMessages($channelId: ID!, $limit: Int, $nextToken: String) {
  listMessages(
    filter: { channelId: { eq: $channelId } }
    limit: $limit
    nextToken: $nextToken
  ) {
    items {
      id
      channelId
      content
      senderId
      createdAt
      updatedAt
    }
    nextToken
  }
}

# Check if a group name already exists
query CheckGroupNameExists($name: String!) {
  listGroups(
    filter: { name: { eq: $name } }
    limit: 1
  ) {
    items {
      id
      name
    }
  }
}

# List all groups
query ListGroups($filter: ModelGroupFilterInput, $limit: Int, $nextToken: String) {
  listGroups(filter: $filter, limit: $limit, nextToken: $nextToken) {
    items {
      id
      groupId
      name
      createdAt
      updatedAt
    }
    nextToken
  }
}

# List user's groups with details
query ListUserGroups($filter: ModelUserGroupFilterInput, $limit: Int, $nextToken: String) {
  listUserGroups(filter: $filter, limit: $limit, nextToken: $nextToken) {
    items {
      id
      userId
      groupId
      user {
        id
        userId
        userName
        name
        firstName
        lastName
        avatarUri
      }
      group {
        id
        groupId
        name
        createdAt
        updatedAt
      }
      createdAt
      updatedAt
    }
    nextToken
  }
}
